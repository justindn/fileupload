function $fileUpload(e,t){function i(){function i(e,t){var i=document.createElement("div");i.className="file-upload-box";var a=document.createElement("span");a.innerHTML=e+", size: "+t;var n=document.createElement("div");n.className="file-upload-box-info",n.appendChild(a),i.appendChild(n);var s=document.createElement("progress");s.value="0",i.appendChild(s);var l={container:i,info:n,bar:s,messageElement:a,message:function(e){this.messageElement.innerHTML=e,this.info.className="file-upload-box-info",this.info.setAttribute("title",e)},errorMessage:function(e){this.messageElement.innerHTML=e,this.info.className=this.info.className+" error_message",this.info.setAttribute("title",e)},barValue:function(e){this.bar.value=e},barMax:function(e){this.bar.max=e}};return l}function n(){u<d.length?d[u].loaded!==!0?s():r():(m.removeAttribute("disabled"),p.removeAttribute("disabled"),u=0,t.onAllFilesLoaded&&t.onAllFilesLoaded(d))}function s(){m.setAttribute("disabled","disabled"),p.setAttribute("disabled","disabled"),d[u].progressBar.message(t.language.loading+d[u].name+"...");var e=new XMLHttpRequest;e.onload=function(){return 200==this.status?(a=this.responseText,void r(a)):void 0},e.upload.onprogress=function(e){l(e.loaded,e.total)},e.onerror=function(){f<t.maxErrorsCount?(f++,d[u].progressBar.errorMessage("("+f+")".settings.language.tryingToSend+d[u].name+"..."),d[u].progressBar.barValue("0"),setTimeout(s,t.errorTimeout)):(alert(t.language.error+this.statusText),d[u].progressBar.errorMessage(t.language.failed+d[u].name),m.removeAttribute("disabled"),p.removeAttribute("disabled"))},e.open("POST",t.acceptor,!0);var i=new FormData;i.append("files",d[u].file);for(var n in t.data){if("function"==typeof t.data[n])var o=t.data[n]();else var o=t.data[n];i.append(n,o)}e.send(i)}function l(e,t){d[u].progressBar.barMax(t),d[u].progressBar.barValue(e)}function r(e){d[u].progressBar.message(d[u].name+"  "+t.language.loaded),t.onFileLoaded&&("undefined"==typeof e&&(e=""),d[u].status=e,t.onFileLoaded(d[u])),d[u].loaded=!0,u++,n()}if("undefined"!=typeof e){"undefined"==typeof t.maxErrorsCount&&(t.maxErrorsCount="10"),"undefined"==typeof t.maxFileSize&&(t.maxFileSize="8388608"),"undefined"==typeof t.errorTimeout&&(t.errorTimeout="1000"),"undefined"==typeof t.callback?t.callback=!1:t.onAllFilesLoaded=t.callback,"undefined"==typeof t.onAllFilesLoaded?t.onAllFilesLoaded=!1:t.callback=t.onAllFilesLoaded,"undefined"==typeof t.onFileLoaded&&(t.onFileLoaded=!1),"undefined"==typeof t.showPreviews&&(t.showPreviews=!1),"undefined"==typeof t.previewHeight&&(t.previewHeight="150px"),"undefined"==typeof t.sendButtonClass&&(t.sendButtonClass=""),"undefined"==typeof t.fileInputClass&&(t.fileInputClass=""),"undefined"==typeof t.data&&(t.data={}),"undefined"==typeof t.language&&(t.language={loaded:"loaded",uploadfiles:"Upload file(s)",tooBig:" - error: file is too big",loading:"Loading: ",tryingToSend:" Trying to send ",error:"Something wrong. There is an error: \n",failed:"Failed: "});var o=document.getElementById(e);"undefined"==typeof t.fileList?t.fileList=o:(t.fileList=document.getElementById(t.fileList),null===t.fileList&&(t.fileList=o)),"undefined"==typeof t.acceptor&&(t.acceptor="");var d=[],u=0,f=0,p=o.querySelector('input[type="file"]');if("null"!=typeof p){(t.multiple===!0||"undefined"==typeof t.multiple)&&p.setAttribute("multiple","multiple"),""!==t.fileInputClass&&p.setAttribute("class",p.getAttribute("class")+" "+t.fileInputClass);var g=o.querySelector("input[type='submit']");if("null"!=typeof g){var m=document.createElement("input");m.setAttribute("type","button"),m.setAttribute("class","fileupload-button "+t.sendButtonClass),null!==g.getAttribute("class")&&m.setAttribute("class",m.getAttribute("class")+" "+g.getAttribute("class")),null===g.getAttribute("value")?m.setAttribute("value",t.language.uploadfiles):m.setAttribute("value",g.getAttribute("value")),g.setAttribute("disabled","disabled"),g.style.display="none",o.insertBefore(m,g),m.onclick=n;p.onchange=function(){function e(e){var a=e.fileData;s=i(a.name,a.size);var n=/image\/.*/i;if(n.test(a.type)){var l=new Image;l.setAttribute("style","height:"+t.previewHeight+";"),l.src=e.result,s.info.insertBefore(l,s.messageElement)}d[e.fileNumber]={name:a.name,size:a.size,type:a.type,file:a,progressBar:s,loaded:!1},a.size>t.maxFileSize&&(d[e.fileNumber].loaded=!0,d[e.fileNumber].progressBar.errorMessage(a.name+t.language.tooBig)),t.fileList.appendChild(s.container)}for(var a=d.length,n=0;n<this.files.length;n++){var s=i(this.files[n].name,this.files[n].size),l=this.files[n];if(t.showPreviews){var r=new FileReader;r.fileData=l,r.fileNumber=n+a,r.addEventListener("load",function(t){e(t.target,l)}),r.readAsDataURL(l)}else d[n+a]={name:this.files[n].name,size:this.files[n].size,type:this.files[n].type,file:this.files[n],progressBar:s,loaded:!1},this.files[n].size>t.maxFileSize&&(d[n+a].loaded=!0,d[n+a].progressBar.errorMessage(this.files[n].name+t.language.tooBig)),t.fileList.appendChild(s.container)}}}}}}var a;window.File&&window.FileList&&("undefined"==typeof t&&(t={}),window.addEventListener("load",i,!1),$fileUpload.clear=function(){for(var e=document.getElementsByClassName("file-upload-box"),t=e.length-1;t>=0;t--)e[t]&&e[t].parentElement&&e[t].parentElement.removeChild(e[t])})}