function $fileUpload(e,t){function i(){function i(e,t){var i=document.createElement("div");i.className="file-upload-box";var r=document.createElement("div");r.className="file-upload-box-info",r.innerHTML=e+", size: "+t,i.appendChild(r);var s=document.createElement("progress");s.value="0",i.appendChild(s);var a={container:i,info:r,bar:s,message:function(e){this.info.innerHTML=e,this.info.className="file-upload-box-info",this.info.setAttribute("title",e)},errorMessage:function(e){this.info.innerHTML=e,this.info.className=this.info.className+" error_message",this.info.setAttribute("title",e)},barValue:function(e){this.bar.value=e},barMax:function(e){this.bar.max=e}};return a}function s(){d<u.length?u[d].loaded!==!0?a():o():(b.removeAttribute("disabled"),p.removeAttribute("disabled"),d=0,t.callback&&t.callback())}function a(){b.setAttribute("disabled","disabled"),p.setAttribute("disabled","disabled"),u[d].progressBar.message("Loading: "+u[d].name+"...");var e=new XMLHttpRequest;e.onload=function(){return 200==this.status?(r=this.responseText,void o()):void 0},e.upload.onprogress=function(e){n(e.loaded,e.total)},e.onerror=function(){f<t.maxErrorsCount?(f++,u[d].progressBar.errorMessage("("+f+") Trying to send "+u[d].name+"..."),u[d].progressBar.barValue("0"),setTimeout(a,t.errorTimeout)):(alert("Something wrong. There is an error: \n"+this.statusText),u[d].progressBar.errorMessage("Failed: "+u[d].name),b.removeAttribute("disabled"),p.removeAttribute("disabled"))},e.open("POST",t.acceptor,!0);var i=new FormData;i.append("files",u[d].file),e.send(i)}function n(e,t){u[d].progressBar.barMax(t),u[d].progressBar.barValue(e)}function o(){u[d].progressBar.message(u[d].name+"  "+r),u[d].loaded=!0,d++,s()}if("undefined"!=typeof e){"undefined"==typeof t.maxErrorsCount&&(t.maxErrorsCount="10"),"undefined"==typeof t.maxFileSize&&(t.maxFileSize="8388608"),"undefined"==typeof t.errorTimeout&&(t.errorTimeout="1000"),"undefined"==typeof t.callback&&(t.callback=!1);var l=document.getElementById(e);"undefined"==typeof t.fileList?t.fileList=l:(t.fileList=document.getElementById(t.fileList),"null"==typeof t.fileList&&(t.fileList=l)),"undefined"==typeof t.acceptor&&(t.acceptor="upload.php");var u=[],d=0,f=0,p=l.querySelector('input[type="file"]');if("null"!=typeof p){p.setAttribute("multiple","multiple");var c=l.querySelector("input[type='submit']");if("null"!=typeof c){var b=document.createElement("input");b.setAttribute("type","button"),b.setAttribute("class","fileupload-button"),null!=c.getAttribute("class")&&b.setAttribute("class",b.getAttribute("class")+" "+c.getAttribute("class")),null===c.getAttribute("value")?b.setAttribute("value","Upload file(s)"):b.setAttribute("value",c.getAttribute("value")),c.setAttribute("disabled","disabled"),c.style.display="none",l.insertBefore(b,c),b.onclick=s,p.onchange=function(){for(var e=u.length,r=0;r<this.files.length;r++)pbar=i(this.files[r].name,this.files[r].size),u[r+e]={name:this.files[r].name,size:this.files[r].size,type:this.files[r].type,file:this.files[r],progressBar:pbar,loaded:!1},t.fileList.appendChild(pbar.container),this.files[r].size>t.maxFileSize&&(u[r+e].loaded=!0,u[r+e].progressBar.errorMessage(this.files[r].name+" - error: file is too big"))}}}}}var r;window.File&&window.FileList&&("undefined"==typeof t&&(t={}),document.addEventListener("DOMContentLoaded",i,!1))}