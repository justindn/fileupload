function $fileUpload(e,t){function i(){function i(e,t){var i=document.createElement("div");i.className="file-upload-box";var a=document.createElement("span");a.innerHTML=e+", size: "+t;var s=document.createElement("div");s.className="file-upload-box-info",s.appendChild(a),i.appendChild(s);var n=document.createElement("progress");n.value="0",i.appendChild(n);var l={container:i,info:s,bar:n,messageElement:a,message:function(e){this.messageElement.innerHTML=e,this.info.className="file-upload-box-info",this.info.setAttribute("title",e)},errorMessage:function(e){this.messageElement.innerHTML=e,this.info.className=this.info.className+" error_message",this.info.setAttribute("title",e)},barValue:function(e){this.bar.value=e},barMax:function(e){this.bar.max=e}};return l}function n(){f<u.length?u[f].loaded!==!0?l():o():(g.removeAttribute("disabled"),m.removeAttribute("disabled"),f=0,t.onAllFilesLoaded&&t.onAllFilesLoaded(u))}function l(){g.setAttribute("disabled","disabled"),m.setAttribute("disabled","disabled"),u[f].progressBar.message(s.loading+u[f].name+"...");var e=new XMLHttpRequest;e.onload=function(){return 200==this.status?(a=this.responseText,void o(a)):void 0},e.upload.onprogress=function(e){r(e.loaded,e.total)},e.onerror=function(){p<t.maxErrorsCount?(p++,u[f].progressBar.errorMessage("("+p+")".language.tryingToSend+u[f].name+"..."),u[f].progressBar.barValue("0"),setTimeout(l,t.errorTimeout)):(alert(s.error+this.statusText),u[f].progressBar.errorMessage(s.failed+u[f].name),g.removeAttribute("disabled"),m.removeAttribute("disabled"))},e.open("POST",t.acceptor,!0);var i=new FormData;i.append("files",u[f].file);for(var n in t.data){if("function"==typeof t.data[n])var d=t.data[n]();else var d=t.data[n];i.append(n,d)}e.send(i)}function r(e,t){u[f].progressBar.barMax(t),u[f].progressBar.barValue(e)}function o(e){u[f].progressBar.message(u[f].name+"  "+s.loaded),t.onFileLoaded&&("undefined"==typeof e&&(e=""),u[f].status=e,t.onFileLoaded(u[f])),u[f].loaded=!0,f++,n()}if("undefined"!=typeof e){"undefined"==typeof t.maxErrorsCount&&(t.maxErrorsCount="10"),"undefined"==typeof t.maxFileSize&&(t.maxFileSize="8388608"),"undefined"==typeof t.errorTimeout&&(t.errorTimeout="1000"),"undefined"==typeof t.callback?t.callback=!1:t.onAllFilesLoaded=t.callback,"undefined"==typeof t.onAllFilesLoaded?t.onAllFilesLoaded=!1:t.callback=t.onAllFilesLoaded,"undefined"==typeof t.onFileLoaded&&(t.onFileLoaded=!1),"undefined"==typeof t.showPreviews&&(t.showPreviews=!1),"undefined"==typeof t.previewHeight&&(t.previewHeight="150px"),"undefined"==typeof t.sendButtonClass&&(t.sendButtonClass=""),"undefined"==typeof t.fileInputClass&&(t.fileInputClass=""),"undefined"==typeof t.data&&(t.data={});var d=document.getElementById(e);"undefined"==typeof t.fileList?t.fileList=d:(t.fileList=document.getElementById(t.fileList),null===t.fileList&&(t.fileList=d)),"undefined"==typeof t.acceptor&&(t.acceptor="");var u=[],f=0,p=0,m=d.querySelector('input[type="file"]');if("null"!=typeof m){(t.multiple===!0||"undefined"==typeof t.multiple)&&m.setAttribute("multiple","multiple"),""!==t.fileInputClass&&m.setAttribute("class",m.getAttribute("class")+" "+t.fileInputClass);var c=d.querySelector("input[type='submit']");if("null"!=typeof c){var g=document.createElement("input");g.setAttribute("type","button"),g.setAttribute("class","fileupload-button "+t.sendButtonClass),null!==c.getAttribute("class")&&g.setAttribute("class",g.getAttribute("class")+" "+c.getAttribute("class")),null===c.getAttribute("value")?g.setAttribute("value",s.uploadfiles):g.setAttribute("value",c.getAttribute("value")),c.setAttribute("disabled","disabled"),c.style.display="none",d.insertBefore(g,c),g.onclick=n;m.onchange=function(){function e(e){var a=e.fileData;l=i(a.name,a.size);var n=/image\/.*/i;if(n.test(a.type)){var r=new Image;r.setAttribute("style","height:"+t.previewHeight+";"),r.src=e.result,l.info.insertBefore(r,l.messageElement)}u[e.fileNumber]={name:a.name,size:a.size,type:a.type,file:a,progressBar:l,loaded:!1},a.size>t.maxFileSize&&(u[e.fileNumber].loaded=!0,u[e.fileNumber].progressBar.errorMessage(a.name+s.tooBig)),t.fileList.appendChild(l.container)}for(var a=u.length,n=0;n<this.files.length;n++){var l=i(this.files[n].name,this.files[n].size),r=this.files[n];if(t.showPreviews){var o=new FileReader;o.fileData=r,o.fileNumber=n+a,o.addEventListener("load",function(t){e(t.target,r)}),o.readAsDataURL(r)}else u[n+a]={name:this.files[n].name,size:this.files[n].size,type:this.files[n].type,file:this.files[n],progressBar:l,loaded:!1},this.files[n].size>t.maxFileSize&&(u[n+a].loaded=!0,u[n+a].progressBar.errorMessage(this.files[n].name+s.tooBig)),t.fileList.appendChild(l.container)}}}}}}var a,s={loaded:"loaded",uploadfiles:"Upload file(s)",tooBig:" - error: file is too big",loading:"Loading: ",tryingToSend:" Trying to send ",error:"Something wrong. There is an error: \n",failed:"Failed: "};window.File&&window.FileList&&("undefined"==typeof t&&(t={}),window.addEventListener("load",i,!1),$fileUpload.clear=function(){for(var e=document.getElementsByClassName("file-upload-box"),t=e.length-1;t>=0;t--)e[t]&&e[t].parentElement&&e[t].parentElement.removeChild(e[t])})}