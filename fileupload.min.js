function $fileUpload(e,t){function i(){function i(e,t){var i=document.createElement("div");i.className="file-upload-box";var r=document.createElement("span");r.innerHTML=e+", size: "+t;var s=document.createElement("div");s.className="file-upload-box-info",s.appendChild(r),i.appendChild(s);var a=document.createElement("progress");a.value="0",i.appendChild(a);var n={container:i,info:s,bar:a,messageElement:r,message:function(e){this.messageElement.innerHTML=e,this.info.className="file-upload-box-info",this.info.setAttribute("title",e)},errorMessage:function(e){this.messageElement.innerHTML=e,this.info.className=this.info.className+" error_message",this.info.setAttribute("title",e)},barValue:function(e){this.bar.value=e},barMax:function(e){this.bar.max=e}};return n}function s(){u<d.length?d[u].loaded!==!0?a():o():(c.removeAttribute("disabled"),p.removeAttribute("disabled"),u=0,t.callback&&t.callback(d))}function a(){c.setAttribute("disabled","disabled"),p.setAttribute("disabled","disabled"),d[u].progressBar.message("Loading: "+d[u].name+"...");var e=new XMLHttpRequest;e.onload=function(){return 200==this.status?(r=this.responseText,void o()):void 0},e.upload.onprogress=function(e){n(e.loaded,e.total)},e.onerror=function(){f<t.maxErrorsCount?(f++,d[u].progressBar.errorMessage("("+f+") Trying to send "+d[u].name+"..."),d[u].progressBar.barValue("0"),setTimeout(a,t.errorTimeout)):(alert("Something wrong. There is an error: \n"+this.statusText),d[u].progressBar.errorMessage("Failed: "+d[u].name),c.removeAttribute("disabled"),p.removeAttribute("disabled"))},e.open("POST",t.acceptor,!0);var i=new FormData;i.append("files",d[u].file),e.send(i)}function n(e,t){d[u].progressBar.barMax(t),d[u].progressBar.barValue(e)}function o(){d[u].progressBar.message(d[u].name+"  "+r),t.onFileLoaded&&t.onFileLoaded(d[u].file),d[u].loaded=!0,u++,s()}if("undefined"!=typeof e){"undefined"==typeof t.maxErrorsCount&&(t.maxErrorsCount="10"),"undefined"==typeof t.maxFileSize&&(t.maxFileSize="8388608"),"undefined"==typeof t.errorTimeout&&(t.errorTimeout="1000"),"undefined"==typeof t.callback&&(t.callback=!1),"undefined"==typeof t.onFileLoaded&&(t.onFileLoaded=!1),"undefined"==typeof t.showPreviews&&(t.showPreviews=!1),"undefined"==typeof t.previewHeight&&(t.previewHeight="150px");var l=document.getElementById(e);"undefined"==typeof t.fileList?t.fileList=l:(t.fileList=document.getElementById(t.fileList),"null"==typeof t.fileList&&(t.fileList=l)),"undefined"==typeof t.acceptor&&(t.acceptor="upload.php");var d=[],u=0,f=0,p=l.querySelector('input[type="file"]');if("null"!=typeof p){p.setAttribute("multiple","multiple");var m=l.querySelector("input[type='submit']");if("null"!=typeof m){var c=document.createElement("input");c.setAttribute("type","button"),c.setAttribute("class","fileupload-button"),null!=m.getAttribute("class")&&c.setAttribute("class",c.getAttribute("class")+" "+m.getAttribute("class")),null===m.getAttribute("value")?c.setAttribute("value","Upload file(s)"):c.setAttribute("value",m.getAttribute("value")),m.setAttribute("disabled","disabled"),m.style.display="none",l.insertBefore(c,m),c.onclick=s;p.onchange=function(){function e(e){var r=e.fileData;a=i(r.name,r.size);var s=/image\/.*/i;if(s.test(r.type)){var n=new Image;n.setAttribute("style","height:"+t.previewHeight+";"),n.src=e.result,a.info.insertBefore(n,a.messageElement)}d[e.fileNumber]={name:r.name,size:r.size,type:r.type,file:r,progressBar:a,loaded:!1},r.size>t.maxFileSize&&(d[e.fileNumber].loaded=!0,d[e.fileNumber].progressBar.errorMessage(r.name+" - error: file is too big")),t.fileList.appendChild(a.container)}for(var r=d.length,s=0;s<this.files.length;s++){var a=i(this.files[s].name,this.files[s].size),n=this.files[s];if(t.showPreviews){var o=new FileReader;o.fileData=n,o.fileNumber=s+r,o.addEventListener("load",function(t){e(t.target,n)}),o.readAsDataURL(n)}else d[s+r]={name:this.files[s].name,size:this.files[s].size,type:this.files[s].type,file:this.files[s],progressBar:a,loaded:!1},this.files[s].size>t.maxFileSize&&(d[s+r].loaded=!0,d[s+r].progressBar.errorMessage(this.files[s].name+" - error: file is too big")),t.fileList.appendChild(a.container)}}}}}}var r;window.File&&window.FileList&&("undefined"==typeof t&&(t={}),document.addEventListener("DOMContentLoaded",i,!1))}